<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="loginstyle.css">
    <title>관리자페이지</title>
</head>
<body>
    <h1>MapZip 관리자 페이지입니다</h1>
    <h2>패치사항에 알려줄 내용을 적는 부분입니다.</h2>
    <label>현재 패치공지사항 : </label><br />
    <textarea id="old_fetch_contents" cols="100" rows="15" readonly="readonly"></textarea>
    <form id="contact-form" action="admin.html" method="post">
        <label>새로운 패치사항 : </label><br />
        <textarea name="new_fetch_contents" cols="100" rows="20"></textarea>
        <input type="hidden" name="do" value="ok" />
        <input type="submit" value="submit" id="fetch_submit"/>
    </form>

    <script>
        function fill_old() {
            var old_patch = document.getElementById("old_fetch_contents");
            old_patch.value = "<?php echo($_POST['new_fetch_contents']); ?>";
            document.write("this is fill_old");
        }
        
    </script>

    <?php
    include("../fmysql.php");
    include("../mapzip-mysql-define.php");
    include("../mapzip-state-define.php");

    if(!$conn = connect_mysqli(MYSQL_IP,MAIN_DB,DB_PASSWORD,USE_DB)){
        echo "connnection error!\n";
        //$to_client['state']=DB_CONNECTION_ERROR;
    }
    else{
        echo "connect success!<br>";
    }

    $sql = "SELECT * FROM ".UPDATE_TABLE;

    if(!$result = mysqli_query($conn,$sql)){
        echo "query fail...\n";
        //$to_client['state']=SQL_QUERY_ERROR;
    }
    while($row = mysqli_fetch_assoc($result)){
         echo($row['id']."<br>");
         echo($row['version']."<br>");
         echo($row['contents']."<br>");
    }
    
    if($_POST['do']=="ok"){
    	echo("new contents : ".$_POST['new_fetch_contents']." !<br>");
    	echo "<script>fill_old();</script><br>";
    }

    ?>
</body>